variables:
  LW_ACCOUNT: $LW_ACCOUNT
  LW_API_KEY: $LW_API_KEY
  LW_API_SECRET: $LW_API_SECRET

steps:
#build docker container
- name: 'gcr.io/cloud-builders/docker'
  #args: [ 'build', '-t', 'gcr.io/$PROJECT_ID/hello-app', '.']
  echo "Dummy build step"

script: |
    #!/usr/bin/env bash
    echo "LW_ACCOUNT=$(LW_ACCOUNT)" > env.list
    echo "LW_API_KEY=$(LW_API_KEY)" >> env.list
    echo "LW_API_SECRET=$(LW_API_SECRET)" >> env.list
    echo "Running Lacework IaC checks."
    echo "SCAN_COMMAND=tf-scan" >> env.list
    # - echo "SCAN_DIR=terraform" >> env.list
    #echo "WORKSPACE=src" >> env.list
    # - echo "EXIT_FLAG=High=2" >> env.list
    docker run --env-file env.list -v "$(pwd):/app/src" lacework/codesec-iac:latest
